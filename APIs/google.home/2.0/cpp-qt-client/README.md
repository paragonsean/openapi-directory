# C++ Qt API client

# 

Google Home

- API version: 2.0
- Generator version: 7.9.0

# Google Home Local API
This is an unofficial documentation of the local API used by the Home app to communicate with GH devices.
[GitHub Repo](https://github.com/rithvikvibhu/GHLocalApi)

[![GitHub stars](https://img.shields.io/github/stars/rithvikvibhu/GHLocalApi)](https://github.com/rithvikvibhu/GHLocalApi/stargazers) [![GitHub license](https://img.shields.io/github/license/rithvikvibhu/GHLocalApi)](https://github.com/rithvikvibhu/GHLocalApi/blob/master/LICENSE.md)

## Getting Started

Requests must be made over HTTPS, port 8443, so the base URL for these endpoints is: `https://<google-home-ip>:8443/setup/`

Get the IP of Google Home from the Google Home app (Device Settings -> End of the list) or from your router.

GET requests are simple, in the browser kind.  
POST requests need to set the header (when there's a body): `content-type: application/json`

## Authentication

Since June 2019, most requests (with exceptions like `/setup/eureka_info`) need a local authorization token.

There are 3 kinds of tokens involved here:

### Local Authorization Token
This token must be sent in all requests in the header `cast-local-authorization-token`. It is short-lived (~1 day) and may change unexpectedly (with a sync, change in homegraph, etc.)
##### Get this token
- With access to an android device, [get this token directly by either method](https://gist.github.com/rithvikvibhu/1a0f4937af957ef6a78453e3be482c1f).
- Without a device, or to integrate it with a script, use an access token to get the homegraph and extract the token. To get an access token, read the next section. Check the example section for more info.

### Access Token
This is a standard google oauth2 access token. It is in the form `ya29.***`.
This gives access to the Google Home Foyer API. These expire in an hour.
Use this to get the homegraph (and then the local authorization token above).
##### Get this token
To get this access token, either a Google account username/password or a Google Master Token is needed. More info in the gist.
Use the script [from this gist](https://gist.github.com/rithvikvibhu/952f83ea656c6782fbd0f1645059055d).

### Master Token
This is in the form `aas_et/_***` and can be used to request access tokens.
##### Get this token
The same [script in the gist](https://gist.github.com/rithvikvibhu/952f83ea656c6782fbd0f1645059055d) that gets the access token can also get the master token. Needs Google account creds.

## Example

Here's the whole flow from just a pair of username/password to using the local API.

Prerequisites:
- [grpcurl](https://github.com/fullstorydev/grpcurl)
- [Proto files](https://drive.google.com/drive/folders/1RvnN3y-G23pd2SWHmfV_7sef8QU5GNF4?usp=sharing) (preserve folder structure)

### 1. Get an access token with the script
- Download get_tokens.py
- Fill in username and password
```sh
python3 get_tokens.py
# Note down the access token printed.
```

### 2. Use the access token and get home graph
- This prints the json and uses jq to parse and filter out the fields deviceName and localAuthToken
- This will give a list of all devices and their local auth tokens
```sh
./grpcurl -H 'authorization: Bearer ya29.a0Af****' \\
 -import-path /path/to/protos \\
 -proto /path/to/protos/google/internal/home/foyer/v1.proto \\
 googlehomefoyer-pa.googleapis.com:443 \\
 google.internal.home.foyer.v1.StructuresService/GetHomeGraph | jq '.home.devices[] | {deviceName, localAuthToken}'
# Note down the local auth token for the device you want.
```

### 3. Make the call to the local device using the local auth token
```sh
curl -H \"cast-local-authorization-token: LOCAL_AUTH_TOKEN\" --verbose --insecure https://192.168.0.18:8443/setup/bluetooth/status
```


*Automatically generated by the [OpenAPI Generator](https://openapi-generator.tech)*


## Requirements

Building the API client library requires:

1. CMake 3.2+
2. Qt
3. C++ Compiler

## Getting Started

example.h:
```c++

#include <iostream>
#include "../client/OAIAssistantApi.h"

using namespace test_namespace;

class Example : public QObject {
    Q_OBJECT
    OAIAccessibilityRequest create();
public Q_SLOTS:
   void exampleFunction1();
};

```

example.cpp:
```c++

#include "../client/OAIAssistantApi.h"
#include "example.h"
#include <QTimer>
#include <QEventLoop>

OAIAccessibilityRequest Example::create(){
    OAIAccessibilityRequest obj;
 return obj;
}

void Example::exampleFunction1(){
     OAIAssistantApi apiInstance;
     
      // Configure API key authorization: cast-local-authorization-token
      apiInstance.setApiKey("YOUR API KEY NAME","YOUR API KEY");

      QEventLoop loop;
      connect(&apiInstance, &OAIAssistantApi::accessibilitySignal, [&]() {
          loop.quit();
      });
      connect(&apiInstance, &OAIAssistantApi::accessibilitySignalE, [&](QNetworkReply::NetworkError, QString error_str) {
          qDebug() << "Error happened while issuing request : " << error_str;
          loop.quit();
      });

      OAIAccessibilityRequest oai_accessibility_request = create(); // OAIAccessibilityRequest | 
      apiInstance.accessibility(oai_accessibility_request);
      QTimer::singleShot(5000, &loop, &QEventLoop::quit);
      loop.exec();
  }

```

## Documentation for Servers

Parameterized Servers are supported. Define a server in the API for each endpoint with arbitrary numbers of variables:

```yaml
servers:
- url: http://{server}:{port}/{basePath}
  description: Description of the Server
  variables:
    server:
        enum:
          - 'petstore'
          - 'qa-petstore'
          - 'dev-petstore'
        default: 'petstore'
    port:
      enum:
        - '3000'
        - '1000'
      default: '3000'
    basePath:
      default: v1
```
To change the default variable, use this function in each Api:
```c++
int setDefaultServerValue(int serverIndex,const QString &operation, const QString &variable,const QString &val);
```
The parameter "serverIndex" will choose a server from the server list for each endpoint. There is always at least one server with index 0. The Parameter "operation" should be the desired endpoint operationid.
Variable is the name of the variable you wish to change and the value is the new default Value.
The function will return -1 when the variable does not exists, -2 if value is not defined in the variable enum and -3 if the operation is not found.

If your endpoint has multiple server objects in the servers array, you can set the server that will be used with this function:
```c++
void setServerIndex(const QString &operation, int serverIndex);
```
Parameter "operation" should be your operationid. "serverIndex" is the index you want to set as your default server. The function will check if there is a server with your index.
Here is an example of multiple servers in the servers array. The first server will have index 0 and the second will have index 1.
```yaml
servers:
- url: http://{server}:8080/
  description: Description of the Server
  variables:
    server:
        enum:
          - 'petstore'
          - 'qa-petstore'
          - 'dev-petstore'
        default: 'petstore'
- url: https://localhost:8080/v1
```

## Documentation for Authorization

Authentication schemes defined for the API:
### cast-local-authorization-token


- **Type**: API key
- **API key parameter name**: cast-local-authorization-token
- **Location**: HTTP header


## Author




## License

 for more information visit []()