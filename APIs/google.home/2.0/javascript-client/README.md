# google_home

GoogleHome - JavaScript client for google_home
# Google Home Local API
This is an unofficial documentation of the local API used by the Home app to communicate with GH devices.
[GitHub Repo](https://github.com/rithvikvibhu/GHLocalApi)

[![GitHub stars](https://img.shields.io/github/stars/rithvikvibhu/GHLocalApi)](https://github.com/rithvikvibhu/GHLocalApi/stargazers) [![GitHub license](https://img.shields.io/github/license/rithvikvibhu/GHLocalApi)](https://github.com/rithvikvibhu/GHLocalApi/blob/master/LICENSE.md)

## Getting Started

Requests must be made over HTTPS, port 8443, so the base URL for these endpoints is: `https://<google-home-ip>:8443/setup/`

Get the IP of Google Home from the Google Home app (Device Settings -> End of the list) or from your router.

GET requests are simple, in the browser kind.  
POST requests need to set the header (when there's a body): `content-type: application/json`

## Authentication

Since June 2019, most requests (with exceptions like `/setup/eureka_info`) need a local authorization token.

There are 3 kinds of tokens involved here:

### Local Authorization Token
This token must be sent in all requests in the header `cast-local-authorization-token`. It is short-lived (~1 day) and may change unexpectedly (with a sync, change in homegraph, etc.)
##### Get this token
- With access to an android device, [get this token directly by either method](https://gist.github.com/rithvikvibhu/1a0f4937af957ef6a78453e3be482c1f).
- Without a device, or to integrate it with a script, use an access token to get the homegraph and extract the token. To get an access token, read the next section. Check the example section for more info.

### Access Token
This is a standard google oauth2 access token. It is in the form `ya29.***`.
This gives access to the Google Home Foyer API. These expire in an hour.
Use this to get the homegraph (and then the local authorization token above).
##### Get this token
To get this access token, either a Google account username/password or a Google Master Token is needed. More info in the gist.
Use the script [from this gist](https://gist.github.com/rithvikvibhu/952f83ea656c6782fbd0f1645059055d).

### Master Token
This is in the form `aas_et/_***` and can be used to request access tokens.
##### Get this token
The same [script in the gist](https://gist.github.com/rithvikvibhu/952f83ea656c6782fbd0f1645059055d) that gets the access token can also get the master token. Needs Google account creds.

## Example

Here's the whole flow from just a pair of username/password to using the local API.

Prerequisites:
- [grpcurl](https://github.com/fullstorydev/grpcurl)
- [Proto files](https://drive.google.com/drive/folders/1RvnN3y-G23pd2SWHmfV_7sef8QU5GNF4?usp=sharing) (preserve folder structure)

### 1. Get an access token with the script
- Download get_tokens.py
- Fill in username and password
```sh
python3 get_tokens.py
# Note down the access token printed.
```

### 2. Use the access token and get home graph
- This prints the json and uses jq to parse and filter out the fields deviceName and localAuthToken
- This will give a list of all devices and their local auth tokens
```sh
./grpcurl -H 'authorization: Bearer ya29.a0Af****' \\
 -import-path /path/to/protos \\
 -proto /path/to/protos/google/internal/home/foyer/v1.proto \\
 googlehomefoyer-pa.googleapis.com:443 \\
 google.internal.home.foyer.v1.StructuresService/GetHomeGraph | jq '.home.devices[] | {deviceName, localAuthToken}'
# Note down the local auth token for the device you want.
```

### 3. Make the call to the local device using the local auth token
```sh
curl -H \"cast-local-authorization-token: LOCAL_AUTH_TOKEN\" --verbose --insecure https://192.168.0.18:8443/setup/bluetooth/status
```
This SDK is automatically generated by the [OpenAPI Generator](https://openapi-generator.tech) project:

- API version: 2.0
- Package version: 2.0
- Generator version: 7.9.0
- Build package: org.openapitools.codegen.languages.JavascriptClientCodegen

## Installation

### For [Node.js](https://nodejs.org/)

#### npm

To publish the library as a [npm](https://www.npmjs.com/), please follow the procedure in ["Publishing npm packages"](https://docs.npmjs.com/getting-started/publishing-npm-packages).

Then install it via:

```shell
npm install google_home --save
```

Finally, you need to build the module:

```shell
npm run build
```

##### Local development

To use the library locally without publishing to a remote npm registry, first install the dependencies by changing into the directory containing `package.json` (and this README). Let's call this `JAVASCRIPT_CLIENT_DIR`. Then run:

```shell
npm install
```

Next, [link](https://docs.npmjs.com/cli/link) it globally in npm with the following, also from `JAVASCRIPT_CLIENT_DIR`:

```shell
npm link
```

To use the link you just defined in your project, switch to the directory you want to use your google_home from, and run:

```shell
npm link /path/to/<JAVASCRIPT_CLIENT_DIR>
```

Finally, you need to build the module:

```shell
npm run build
```

#### git

If the library is hosted at a git repository, e.g.https://github.com/GIT_USER_ID/GIT_REPO_ID
then install it via:

```shell
    npm install GIT_USER_ID/GIT_REPO_ID --save
```

### For browser

The library also works in the browser environment via npm and [browserify](http://browserify.org/). After following
the above steps with Node.js and installing browserify with `npm install -g browserify`,
perform the following (assuming *main.js* is your entry file):

```shell
browserify main.js > bundle.js
```

Then include *bundle.js* in the HTML pages.

### Webpack Configuration

Using Webpack you may encounter the following error: "Module not found: Error:
Cannot resolve module", most certainly you should disable AMD loader. Add/merge
the following section to your webpack config:

```javascript
module: {
  rules: [
    {
      parser: {
        amd: false
      }
    }
  ]
}
```

## Getting Started

Please follow the [installation](#installation) instruction and execute the following JS code:

```javascript
var GoogleHome = require('google_home');

var defaultClient = GoogleHome.ApiClient.instance;
// Configure API key authorization: cast-local-authorization-token
var cast-local-authorization-token = defaultClient.authentications['cast-local-authorization-token'];
cast-local-authorization-token.apiKey = "YOUR API KEY"
// Uncomment the following line to set a prefix for the API key, e.g. "Token" (defaults to null)
//cast-local-authorization-token.apiKeyPrefix['cast-local-authorization-token'] = "Token"

var api = new GoogleHome.AssistantApi()
var accessibilityRequest = {"endpoint_enabled":false,"hotword_enabled":false}; // {AccessibilityRequest} 
var callback = function(error, data, response) {
  if (error) {
    console.error(error);
  } else {
    console.log('API called successfully. Returned data: ' + data);
  }
};
api.accessibility(accessibilityRequest, callback);

```

## Documentation for API Endpoints

All URIs are relative to *http://example.com/setup*

Class | Method | HTTP request | Description
------------ | ------------- | ------------- | -------------
*GoogleHome.AssistantApi* | [**accessibility**](docs/AssistantApi.md#accessibility) | **POST** /assistant/a11y_mode | Accessibility
*GoogleHome.AssistantApi* | [**alarmVolume**](docs/AssistantApi.md#alarmVolume) | **POST** /assistant/alarms/volume | Alarm Volume
*GoogleHome.AssistantApi* | [**deleteAlarmsandTimers**](docs/AssistantApi.md#deleteAlarmsandTimers) | **POST** /assistant/alarms/delete | Delete Alarms and Timers
*GoogleHome.AssistantApi* | [**doNotDisturb**](docs/AssistantApi.md#doNotDisturb) | **POST** /assistant/notifications | Do Not Disturb
*GoogleHome.AssistantApi* | [**getAlarmsandTimers**](docs/AssistantApi.md#getAlarmsandTimers) | **GET** /assistant/alarms | Get Alarms and Timers
*GoogleHome.AssistantApi* | [**setEqualizerValues**](docs/AssistantApi.md#setEqualizerValues) | **POST** /user_eq/set_equalizer | Set Equalizer Values
*GoogleHome.BluetoothApi* | [**changeDiscoverability**](docs/BluetoothApi.md#changeDiscoverability) | **POST** /bluetooth/discovery | Change Discoverability
*GoogleHome.BluetoothApi* | [**forgetpaireddevice**](docs/BluetoothApi.md#forgetpaireddevice) | **POST** /bluetooth/bond | Forget paired device
*GoogleHome.BluetoothApi* | [**getPairedDevices**](docs/BluetoothApi.md#getPairedDevices) | **GET** /bluetooth/get_bonded | Get Paired Devices
*GoogleHome.BluetoothApi* | [**getScanResults**](docs/BluetoothApi.md#getScanResults) | **GET** /bluetooth/scan_results | Get Scan Results
*GoogleHome.BluetoothApi* | [**pairwithSpeaker**](docs/BluetoothApi.md#pairwithSpeaker) | **POST** /bluetooth/connect | Pair with Speaker
*GoogleHome.BluetoothApi* | [**scanfordevices**](docs/BluetoothApi.md#scanfordevices) | **POST** /bluetooth/scan | Scan for devices
*GoogleHome.BluetoothApi* | [**status**](docs/BluetoothApi.md#status) | **GET** /bluetooth/status | Status
*GoogleHome.DeviceInfoApi* | [**appDeviceID**](docs/DeviceInfoApi.md#appDeviceID) | **POST** /get_app_device_id | App Device ID
*GoogleHome.DeviceInfoApi* | [**checkReadyStatus**](docs/DeviceInfoApi.md#checkReadyStatus) | **POST** /assistant/check_ready_status | Check Ready Status
*GoogleHome.DeviceInfoApi* | [**eurekaInfo**](docs/DeviceInfoApi.md#eurekaInfo) | **GET** /eureka_info | Eureka Info
*GoogleHome.DeviceInfoApi* | [**locales**](docs/DeviceInfoApi.md#locales) | **GET** /supported_locales | Locales
*GoogleHome.DeviceInfoApi* | [**offer**](docs/DeviceInfoApi.md#offer) | **GET** /offer | Offer
*GoogleHome.DeviceInfoApi* | [**testInternetDownloadSpeed**](docs/DeviceInfoApi.md#testInternetDownloadSpeed) | **POST** /test_internet_download_speed | Test Internet Download Speed
*GoogleHome.DeviceInfoApi* | [**timezones**](docs/DeviceInfoApi.md#timezones) | **GET** /supported_timezones | Timezones
*GoogleHome.DeviceSettingsApi* | [**nightModesettings**](docs/DeviceSettingsApi.md#nightModesettings) | **POST** /assistant/set_night_mode_params | Night Mode settings
*GoogleHome.DeviceSettingsApi* | [**rebootandFactoryReset**](docs/DeviceSettingsApi.md#rebootandFactoryReset) | **POST** /reboot | Reboot and Factory Reset
*GoogleHome.DeviceSettingsApi* | [**setEurekaInfo**](docs/DeviceSettingsApi.md#setEurekaInfo) | **POST** /set_eureka_info | Set Eureka Info
*GoogleHome.StaticFilesApi* | [**chromecastIcon**](docs/StaticFilesApi.md#chromecastIcon) | **GET** /icon.png | Chromecast Icon
*GoogleHome.StaticFilesApi* | [**legalNotice**](docs/StaticFilesApi.md#legalNotice) | **GET** /NOTICE.html.gz | Legal Notice
*GoogleHome.WifiApi* | [**connecttoWiFiNetwork**](docs/WifiApi.md#connecttoWiFiNetwork) | **POST** /connect_wifi | Connect to Wi-Fi Network
*GoogleHome.WifiApi* | [**forgetWiFiNetwork**](docs/WifiApi.md#forgetWiFiNetwork) | **POST** /forget_wifi | Forget Wi-Fi Network
*GoogleHome.WifiApi* | [**getSavedNetworks**](docs/WifiApi.md#getSavedNetworks) | **GET** /configured_networks | Get Saved Networks
*GoogleHome.WifiApi* | [**getWiFiScanResults**](docs/WifiApi.md#getWiFiScanResults) | **GET** /scan_results | Get Wi-Fi Scan Results
*GoogleHome.WifiApi* | [**scanforNetworks**](docs/WifiApi.md#scanforNetworks) | **POST** /scan_wifi | Scan for Networks


## Documentation for Models

 - [GoogleHome.AccessibilityRequest](docs/AccessibilityRequest.md)
 - [GoogleHome.Alarm](docs/Alarm.md)
 - [GoogleHome.AlarmVolumeRequest](docs/AlarmVolumeRequest.md)
 - [GoogleHome.Aogh](docs/Aogh.md)
 - [GoogleHome.AppDeviceIDRequest](docs/AppDeviceIDRequest.md)
 - [GoogleHome.Audio](docs/Audio.md)
 - [GoogleHome.BuildInfo](docs/BuildInfo.md)
 - [GoogleHome.Capabilities](docs/Capabilities.md)
 - [GoogleHome.ChangeDiscoverabilityRequest](docs/ChangeDiscoverabilityRequest.md)
 - [GoogleHome.CheckReadyStatusRequest](docs/CheckReadyStatusRequest.md)
 - [GoogleHome.ConnectedDevice](docs/ConnectedDevice.md)
 - [GoogleHome.ConnecttoWiFiNetworkRequest](docs/ConnecttoWiFiNetworkRequest.md)
 - [GoogleHome.DatePattern](docs/DatePattern.md)
 - [GoogleHome.DeleteAlarmsandTimersRequest](docs/DeleteAlarmsandTimersRequest.md)
 - [GoogleHome.Detail](docs/Detail.md)
 - [GoogleHome.Device](docs/Device.md)
 - [GoogleHome.DeviceInfo](docs/DeviceInfo.md)
 - [GoogleHome.Example1](docs/Example1.md)
 - [GoogleHome.Example11](docs/Example11.md)
 - [GoogleHome.Example110](docs/Example110.md)
 - [GoogleHome.Example111](docs/Example111.md)
 - [GoogleHome.Example112](docs/Example112.md)
 - [GoogleHome.Example113](docs/Example113.md)
 - [GoogleHome.Example114](docs/Example114.md)
 - [GoogleHome.Example12](docs/Example12.md)
 - [GoogleHome.Example13](docs/Example13.md)
 - [GoogleHome.Example14](docs/Example14.md)
 - [GoogleHome.Example15](docs/Example15.md)
 - [GoogleHome.Example16](docs/Example16.md)
 - [GoogleHome.Example17](docs/Example17.md)
 - [GoogleHome.Example18](docs/Example18.md)
 - [GoogleHome.Example19](docs/Example19.md)
 - [GoogleHome.ForgetWiFiNetworkRequest](docs/ForgetWiFiNetworkRequest.md)
 - [GoogleHome.ForgetpaireddeviceRequest](docs/ForgetpaireddeviceRequest.md)
 - [GoogleHome.Getcurrentstate](docs/Getcurrentstate.md)
 - [GoogleHome.Getcurrentvalues](docs/Getcurrentvalues.md)
 - [GoogleHome.Getvolume](docs/Getvolume.md)
 - [GoogleHome.HighShelf](docs/HighShelf.md)
 - [GoogleHome.HighShelf1](docs/HighShelf1.md)
 - [GoogleHome.IconList](docs/IconList.md)
 - [GoogleHome.Locale](docs/Locale.md)
 - [GoogleHome.LowShelf](docs/LowShelf.md)
 - [GoogleHome.LowShelf1](docs/LowShelf1.md)
 - [GoogleHome.Multizone](docs/Multizone.md)
 - [GoogleHome.Net](docs/Net.md)
 - [GoogleHome.NightModeParams](docs/NightModeParams.md)
 - [GoogleHome.NightModesettingsRequest](docs/NightModesettingsRequest.md)
 - [GoogleHome.Opencast](docs/Opencast.md)
 - [GoogleHome.OptIn](docs/OptIn.md)
 - [GoogleHome.OptIn1](docs/OptIn1.md)
 - [GoogleHome.PairwithSpeakerRequest](docs/PairwithSpeakerRequest.md)
 - [GoogleHome.Proxy](docs/Proxy.md)
 - [GoogleHome.RebootandFactoryResetRequest](docs/RebootandFactoryResetRequest.md)
 - [GoogleHome.RemoteSink](docs/RemoteSink.md)
 - [GoogleHome.ScanfordevicesRequest](docs/ScanfordevicesRequest.md)
 - [GoogleHome.SetEqualizerValuesRequest](docs/SetEqualizerValuesRequest.md)
 - [GoogleHome.SetEurekaInfoRequest](docs/SetEurekaInfoRequest.md)
 - [GoogleHome.Settings](docs/Settings.md)
 - [GoogleHome.Settings1](docs/Settings1.md)
 - [GoogleHome.Setup](docs/Setup.md)
 - [GoogleHome.Sign](docs/Sign.md)
 - [GoogleHome.Stats](docs/Stats.md)
 - [GoogleHome.TestInternetDownloadSpeedRequest](docs/TestInternetDownloadSpeedRequest.md)
 - [GoogleHome.TimePattern](docs/TimePattern.md)
 - [GoogleHome.Timer](docs/Timer.md)
 - [GoogleHome.Timezone](docs/Timezone.md)
 - [GoogleHome.UserEq](docs/UserEq.md)
 - [GoogleHome.Wifi](docs/Wifi.md)
 - [GoogleHome.Window](docs/Window.md)
 - [GoogleHome.Window2](docs/Window2.md)


## Documentation for Authorization


Authentication schemes defined for the API:
### cast-local-authorization-token


- **Type**: API key
- **API key parameter name**: cast-local-authorization-token
- **Location**: HTTP header

