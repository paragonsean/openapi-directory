# coding: utf-8

import pytest
import json
from aiohttp import web

from openapi_server.models.done import Done
from openapi_server.models.import_export import ImportExport


pytestmark = pytest.mark.asyncio

async def test_full_export(client):
    """Test case for full_export

    Export the full state of Otoroshi
    """
    headers = { 
        'Accept': 'application/json',
        'Authorization': 'BasicZm9vOmJhcg==',
    }
    response = await client.request(
        method='GET',
        path='/api/otoroshi.json',
        headers=headers,
        )
    assert response.status == 200, 'Response body is : ' + (await response.read()).decode('utf-8')


pytestmark = pytest.mark.asyncio

async def test_full_import(client):
    """Test case for full_import

    Import the full state of Otoroshi
    """
    body = {"date":"2017-07-21T17:32:28Z","errorTemplates":[{"templateMaintenance":"a string value","templateBuild":"a string value","messages":{"key":"value"},"template50x":"a string value","template40x":"a string value","serviceId":"a string value"},{"templateMaintenance":"a string value","templateBuild":"a string value","messages":{"key":"value"},"template50x":"a string value","template40x":"a string value","serviceId":"a string value"}],"serviceDescriptors":[{"metadata":{"key":"value"},"cors":{"excludedPatterns":["a string value","a string value"],"allowMethods":["a string value","a string value"],"allowHeaders":["a string value","a string value"],"exposeHeaders":["a string value","a string value"],"maxAge":123123,"allowCredentials":True,"enabled":True,"allowOrigin":"a string value"},"forceHttps":True,"matchingRoot":"a string value","buildMode":True,"chaosConfig":{"badResponsesFaultConfig":{"responses":[{"headers":{"key":"value"},"body":"a string value","status":123123},{"headers":{"key":"value"},"body":"a string value","status":123123}],"ratio":42.2},"largeResponseFaultConfig":{"additionalRequestSize":123123,"ratio":42.2},"latencyInjectionFaultConfig":{"from":123123,"to":123123,"ratio":42.2},"largeRequestFaultConfig":{"additionalRequestSize":123123,"ratio":42.2},"enabled":True},"targets":[{"scheme":"a string value","host":"www.google.com"},{"scheme":"a string value","host":"www.google.com"}],"enabled":True,"localHost":"a string value","root":"a string value","additionalHeaders":{"key":"value"},"api":{"exposeApi":True,"openApiDescriptorUrl":"http://www.google.com"},"id":"110e8400-e29b-11d4-a716-446655440000","ipFiltering":{"blacklist":["192.192.192.192","192.192.192.192"],"whitelist":["192.192.192.192","192.192.192.192"]},"sendOtoroshiHeadersBack":True,"redirection":{"code":123123,"to":"a string value","enabled":True},"headersVerification":{"key":"value"},"redirectToLocal":True,"userFacing":True,"authConfigRef":"a string value","secComExcludedPatterns":["a string value","a string value"],"xForwardedHeaders":True,"transformerRef":"a string value","Canary":{"root":"a string value","targets":[{"scheme":"a string value","host":"www.google.com"},{"scheme":"a string value","host":"www.google.com"}],"enabled":True,"traffic":123123},"groups":["a string value"],"privatePatterns":["a string value","a string value"],"gzip":{"excludedPatterns":["a string value","a string value"],"blackList":["a string value","a string value"],"whiteList":["a string value","a string value"],"chunkedThreshold":123,"compressionLevel":123123,"enabled":True,"bufferSize":123},"clientConfig":{"retries":123123,"sampleInterval":123123,"useCircuitBreaker":True,"backoffFactor":123123,"maxErrors":123123,"retryInitialDelay":123123,"callTimeout":123123,"globalTimeout":123123},"env":"a string value","enforceSecureCommunication":True,"jwtVerifier":{"algoSettings":{"size":123123,"secret":"a string value","type":"a string value"},"source":{"name":"a string value","type":"a string value"},"strategy":{"verificationSettings":{"mappingSettings":{"values":{"key":"value"},"map":{"key":"value"},"remove":["a string value","a string value"]},"fields":{"key":"value"}},"type":"a string value"},"strict":True,"type":"a string value","enabled":True},"clientValidatorRef":"a string value","publicPatterns":["a string value","a string value"],"localScheme":"a string value","privateApp":True,"domain":"a string value","healthCheck":{"enabled":True,"url":"http://www.google.com"},"name":"a string value","statsdConfig":{"port":123123,"datadog":True,"host":"a string value"},"matchingHeaders":{"key":"value"},"subdomain":"a string value","overrideHost":True,"maintenanceMode":True},{"metadata":{"key":"value"},"cors":{"excludedPatterns":["a string value","a string value"],"allowMethods":["a string value","a string value"],"allowHeaders":["a string value","a string value"],"exposeHeaders":["a string value","a string value"],"maxAge":123123,"allowCredentials":True,"enabled":True,"allowOrigin":"a string value"},"forceHttps":True,"matchingRoot":"a string value","buildMode":True,"chaosConfig":{"badResponsesFaultConfig":{"responses":[{"headers":{"key":"value"},"body":"a string value","status":123123},{"headers":{"key":"value"},"body":"a string value","status":123123}],"ratio":42.2},"largeResponseFaultConfig":{"additionalRequestSize":123123,"ratio":42.2},"latencyInjectionFaultConfig":{"from":123123,"to":123123,"ratio":42.2},"largeRequestFaultConfig":{"additionalRequestSize":123123,"ratio":42.2},"enabled":True},"targets":[{"scheme":"a string value","host":"www.google.com"},{"scheme":"a string value","host":"www.google.com"}],"enabled":True,"localHost":"a string value","root":"a string value","additionalHeaders":{"key":"value"},"api":{"exposeApi":True,"openApiDescriptorUrl":"http://www.google.com"},"id":"110e8400-e29b-11d4-a716-446655440000","ipFiltering":{"blacklist":["192.192.192.192","192.192.192.192"],"whitelist":["192.192.192.192","192.192.192.192"]},"sendOtoroshiHeadersBack":True,"redirection":{"code":123123,"to":"a string value","enabled":True},"headersVerification":{"key":"value"},"redirectToLocal":True,"userFacing":True,"authConfigRef":"a string value","secComExcludedPatterns":["a string value","a string value"],"xForwardedHeaders":True,"transformerRef":"a string value","Canary":{"root":"a string value","targets":[{"scheme":"a string value","host":"www.google.com"},{"scheme":"a string value","host":"www.google.com"}],"enabled":True,"traffic":123123},"groups":["a string value"],"privatePatterns":["a string value","a string value"],"gzip":{"excludedPatterns":["a string value","a string value"],"blackList":["a string value","a string value"],"whiteList":["a string value","a string value"],"chunkedThreshold":123,"compressionLevel":123123,"enabled":True,"bufferSize":123},"clientConfig":{"retries":123123,"sampleInterval":123123,"useCircuitBreaker":True,"backoffFactor":123123,"maxErrors":123123,"retryInitialDelay":123123,"callTimeout":123123,"globalTimeout":123123},"env":"a string value","enforceSecureCommunication":True,"jwtVerifier":{"algoSettings":{"size":123123,"secret":"a string value","type":"a string value"},"source":{"name":"a string value","type":"a string value"},"strategy":{"verificationSettings":{"mappingSettings":{"values":{"key":"value"},"map":{"key":"value"},"remove":["a string value","a string value"]},"fields":{"key":"value"}},"type":"a string value"},"strict":True,"type":"a string value","enabled":True},"clientValidatorRef":"a string value","publicPatterns":["a string value","a string value"],"localScheme":"a string value","privateApp":True,"domain":"a string value","healthCheck":{"enabled":True,"url":"http://www.google.com"},"name":"a string value","statsdConfig":{"port":123123,"datadog":True,"host":"a string value"},"matchingHeaders":{"key":"value"},"subdomain":"a string value","overrideHost":True,"maintenanceMode":True}],"appConfig":{"key":"value"},"simpleAdmins":[{"createdAt":123,"password":"a string value","label":"a string value","username":"a string value"},{"createdAt":123,"password":"a string value","label":"a string value","username":"a string value"}],"stats":{"dataOut":123,"calls":123,"dataIn":123},"apiKeys":[{"metadata":{"key":"value"},"clientId":"a string value","monthlyQuota":123,"throttlingQuota":123,"clientName":"a string value","authorizedEntities":["a string value"],"clientSecret":"a string value","dailyQuota":123,"enabled":True},{"metadata":{"key":"value"},"clientId":"a string value","monthlyQuota":123,"throttlingQuota":123,"clientName":"a string value","authorizedEntities":["a string value"],"clientSecret":"a string value","dailyQuota":123,"enabled":True}],"serviceGroups":[{"name":"a string value","description":"a string value","id":"a string value"},{"name":"a string value","description":"a string value","id":"a string value"}],"label":"a string value","config":{"maxLogsSize":123123,"apiReadOnly":True,"analyticsWebhooks":[{"headers":{"key":"value"},"url":"http://www.google.com"},{"headers":{"key":"value"},"url":"http://www.google.com"}],"elasticReadsConfig":{"clusterUri":"a string value","headers":{"key":"value"},"password":"a string value","index":"a string value","type":"a string value","user":"a string value"},"limitConcurrentRequests":True,"maxConcurrentRequests":123,"endlessIpAddresses":["192.192.192.192","192.192.192.192"],"maxHttp10ResponseSize":123,"streamEntityOnly":True,"backofficeAuth0Config":{"clientId":"a string value","domain":"a string value","callbackUrl":"a string value","clientSecret":"a string value"},"alertsEmails":["admin@otoroshi.io","admin@otoroshi.io"],"autoLinkToDefaultGroup":True,"alertsWebhooks":[{"headers":{"key":"value"},"url":"http://www.google.com"},{"headers":{"key":"value"},"url":"http://www.google.com"}],"middleFingers":True,"privateAppsAuth0Config":{"clientId":"a string value","domain":"a string value","callbackUrl":"a string value","clientSecret":"a string value"},"throttlingQuota":123,"cleverSettings":{"consumerSecret":"a string value","orgaId":"a string value","secret":"a string value","consumerKey":"a string value","token":"a string value"},"u2fLoginOnly":True,"ipFiltering":{"blacklist":["192.192.192.192","192.192.192.192"],"whitelist":["192.192.192.192","192.192.192.192"]},"mailerSettings":{"eu":True,"apiKey":"a string value","domain":"a string value","apiKeyPrivate":"a string value","header":{"key":"value"},"apiKeyPublic":"a string value","type":"a string value","url":"a string value"},"perIpThrottlingQuota":123,"elasticWritesConfigs":[{"clusterUri":"a string value","headers":{"key":"value"},"password":"a string value","index":"a string value","type":"a string value","user":"a string value"},{"clusterUri":"a string value","headers":{"key":"value"},"password":"a string value","index":"a string value","type":"a string value","user":"a string value"}],"lines":["a string value","a string value"],"useCircuitBreakers":True},"dateRaw":123,"admins":[{"createdAt":123,"password":"a string value","registration":{"key":"value"},"label":"a string value","username":"a string value"},{"createdAt":123,"password":"a string value","registration":{"key":"value"},"label":"a string value","username":"a string value"}]}
    headers = { 
        'Accept': 'application/json',
        'Content-Type': 'application/json',
        'Authorization': 'BasicZm9vOmJhcg==',
    }
    response = await client.request(
        method='POST',
        path='/api/otoroshi.json',
        headers=headers,
        json=body,
        )
    assert response.status == 200, 'Response body is : ' + (await response.read()).decode('utf-8')


pytestmark = pytest.mark.asyncio

async def test_full_import_from_file(client):
    """Test case for full_import_from_file

    Import the full state of Otoroshi as a file
    """
    body = {"date":"2017-07-21T17:32:28Z","errorTemplates":[{"templateMaintenance":"a string value","templateBuild":"a string value","messages":{"key":"value"},"template50x":"a string value","template40x":"a string value","serviceId":"a string value"},{"templateMaintenance":"a string value","templateBuild":"a string value","messages":{"key":"value"},"template50x":"a string value","template40x":"a string value","serviceId":"a string value"}],"serviceDescriptors":[{"metadata":{"key":"value"},"cors":{"excludedPatterns":["a string value","a string value"],"allowMethods":["a string value","a string value"],"allowHeaders":["a string value","a string value"],"exposeHeaders":["a string value","a string value"],"maxAge":123123,"allowCredentials":True,"enabled":True,"allowOrigin":"a string value"},"forceHttps":True,"matchingRoot":"a string value","buildMode":True,"chaosConfig":{"badResponsesFaultConfig":{"responses":[{"headers":{"key":"value"},"body":"a string value","status":123123},{"headers":{"key":"value"},"body":"a string value","status":123123}],"ratio":42.2},"largeResponseFaultConfig":{"additionalRequestSize":123123,"ratio":42.2},"latencyInjectionFaultConfig":{"from":123123,"to":123123,"ratio":42.2},"largeRequestFaultConfig":{"additionalRequestSize":123123,"ratio":42.2},"enabled":True},"targets":[{"scheme":"a string value","host":"www.google.com"},{"scheme":"a string value","host":"www.google.com"}],"enabled":True,"localHost":"a string value","root":"a string value","additionalHeaders":{"key":"value"},"api":{"exposeApi":True,"openApiDescriptorUrl":"http://www.google.com"},"id":"110e8400-e29b-11d4-a716-446655440000","ipFiltering":{"blacklist":["192.192.192.192","192.192.192.192"],"whitelist":["192.192.192.192","192.192.192.192"]},"sendOtoroshiHeadersBack":True,"redirection":{"code":123123,"to":"a string value","enabled":True},"headersVerification":{"key":"value"},"redirectToLocal":True,"userFacing":True,"authConfigRef":"a string value","secComExcludedPatterns":["a string value","a string value"],"xForwardedHeaders":True,"transformerRef":"a string value","Canary":{"root":"a string value","targets":[{"scheme":"a string value","host":"www.google.com"},{"scheme":"a string value","host":"www.google.com"}],"enabled":True,"traffic":123123},"groups":["a string value"],"privatePatterns":["a string value","a string value"],"gzip":{"excludedPatterns":["a string value","a string value"],"blackList":["a string value","a string value"],"whiteList":["a string value","a string value"],"chunkedThreshold":123,"compressionLevel":123123,"enabled":True,"bufferSize":123},"clientConfig":{"retries":123123,"sampleInterval":123123,"useCircuitBreaker":True,"backoffFactor":123123,"maxErrors":123123,"retryInitialDelay":123123,"callTimeout":123123,"globalTimeout":123123},"env":"a string value","enforceSecureCommunication":True,"jwtVerifier":{"algoSettings":{"size":123123,"secret":"a string value","type":"a string value"},"source":{"name":"a string value","type":"a string value"},"strategy":{"verificationSettings":{"mappingSettings":{"values":{"key":"value"},"map":{"key":"value"},"remove":["a string value","a string value"]},"fields":{"key":"value"}},"type":"a string value"},"strict":True,"type":"a string value","enabled":True},"clientValidatorRef":"a string value","publicPatterns":["a string value","a string value"],"localScheme":"a string value","privateApp":True,"domain":"a string value","healthCheck":{"enabled":True,"url":"http://www.google.com"},"name":"a string value","statsdConfig":{"port":123123,"datadog":True,"host":"a string value"},"matchingHeaders":{"key":"value"},"subdomain":"a string value","overrideHost":True,"maintenanceMode":True},{"metadata":{"key":"value"},"cors":{"excludedPatterns":["a string value","a string value"],"allowMethods":["a string value","a string value"],"allowHeaders":["a string value","a string value"],"exposeHeaders":["a string value","a string value"],"maxAge":123123,"allowCredentials":True,"enabled":True,"allowOrigin":"a string value"},"forceHttps":True,"matchingRoot":"a string value","buildMode":True,"chaosConfig":{"badResponsesFaultConfig":{"responses":[{"headers":{"key":"value"},"body":"a string value","status":123123},{"headers":{"key":"value"},"body":"a string value","status":123123}],"ratio":42.2},"largeResponseFaultConfig":{"additionalRequestSize":123123,"ratio":42.2},"latencyInjectionFaultConfig":{"from":123123,"to":123123,"ratio":42.2},"largeRequestFaultConfig":{"additionalRequestSize":123123,"ratio":42.2},"enabled":True},"targets":[{"scheme":"a string value","host":"www.google.com"},{"scheme":"a string value","host":"www.google.com"}],"enabled":True,"localHost":"a string value","root":"a string value","additionalHeaders":{"key":"value"},"api":{"exposeApi":True,"openApiDescriptorUrl":"http://www.google.com"},"id":"110e8400-e29b-11d4-a716-446655440000","ipFiltering":{"blacklist":["192.192.192.192","192.192.192.192"],"whitelist":["192.192.192.192","192.192.192.192"]},"sendOtoroshiHeadersBack":True,"redirection":{"code":123123,"to":"a string value","enabled":True},"headersVerification":{"key":"value"},"redirectToLocal":True,"userFacing":True,"authConfigRef":"a string value","secComExcludedPatterns":["a string value","a string value"],"xForwardedHeaders":True,"transformerRef":"a string value","Canary":{"root":"a string value","targets":[{"scheme":"a string value","host":"www.google.com"},{"scheme":"a string value","host":"www.google.com"}],"enabled":True,"traffic":123123},"groups":["a string value"],"privatePatterns":["a string value","a string value"],"gzip":{"excludedPatterns":["a string value","a string value"],"blackList":["a string value","a string value"],"whiteList":["a string value","a string value"],"chunkedThreshold":123,"compressionLevel":123123,"enabled":True,"bufferSize":123},"clientConfig":{"retries":123123,"sampleInterval":123123,"useCircuitBreaker":True,"backoffFactor":123123,"maxErrors":123123,"retryInitialDelay":123123,"callTimeout":123123,"globalTimeout":123123},"env":"a string value","enforceSecureCommunication":True,"jwtVerifier":{"algoSettings":{"size":123123,"secret":"a string value","type":"a string value"},"source":{"name":"a string value","type":"a string value"},"strategy":{"verificationSettings":{"mappingSettings":{"values":{"key":"value"},"map":{"key":"value"},"remove":["a string value","a string value"]},"fields":{"key":"value"}},"type":"a string value"},"strict":True,"type":"a string value","enabled":True},"clientValidatorRef":"a string value","publicPatterns":["a string value","a string value"],"localScheme":"a string value","privateApp":True,"domain":"a string value","healthCheck":{"enabled":True,"url":"http://www.google.com"},"name":"a string value","statsdConfig":{"port":123123,"datadog":True,"host":"a string value"},"matchingHeaders":{"key":"value"},"subdomain":"a string value","overrideHost":True,"maintenanceMode":True}],"appConfig":{"key":"value"},"simpleAdmins":[{"createdAt":123,"password":"a string value","label":"a string value","username":"a string value"},{"createdAt":123,"password":"a string value","label":"a string value","username":"a string value"}],"stats":{"dataOut":123,"calls":123,"dataIn":123},"apiKeys":[{"metadata":{"key":"value"},"clientId":"a string value","monthlyQuota":123,"throttlingQuota":123,"clientName":"a string value","authorizedEntities":["a string value"],"clientSecret":"a string value","dailyQuota":123,"enabled":True},{"metadata":{"key":"value"},"clientId":"a string value","monthlyQuota":123,"throttlingQuota":123,"clientName":"a string value","authorizedEntities":["a string value"],"clientSecret":"a string value","dailyQuota":123,"enabled":True}],"serviceGroups":[{"name":"a string value","description":"a string value","id":"a string value"},{"name":"a string value","description":"a string value","id":"a string value"}],"label":"a string value","config":{"maxLogsSize":123123,"apiReadOnly":True,"analyticsWebhooks":[{"headers":{"key":"value"},"url":"http://www.google.com"},{"headers":{"key":"value"},"url":"http://www.google.com"}],"elasticReadsConfig":{"clusterUri":"a string value","headers":{"key":"value"},"password":"a string value","index":"a string value","type":"a string value","user":"a string value"},"limitConcurrentRequests":True,"maxConcurrentRequests":123,"endlessIpAddresses":["192.192.192.192","192.192.192.192"],"maxHttp10ResponseSize":123,"streamEntityOnly":True,"backofficeAuth0Config":{"clientId":"a string value","domain":"a string value","callbackUrl":"a string value","clientSecret":"a string value"},"alertsEmails":["admin@otoroshi.io","admin@otoroshi.io"],"autoLinkToDefaultGroup":True,"alertsWebhooks":[{"headers":{"key":"value"},"url":"http://www.google.com"},{"headers":{"key":"value"},"url":"http://www.google.com"}],"middleFingers":True,"privateAppsAuth0Config":{"clientId":"a string value","domain":"a string value","callbackUrl":"a string value","clientSecret":"a string value"},"throttlingQuota":123,"cleverSettings":{"consumerSecret":"a string value","orgaId":"a string value","secret":"a string value","consumerKey":"a string value","token":"a string value"},"u2fLoginOnly":True,"ipFiltering":{"blacklist":["192.192.192.192","192.192.192.192"],"whitelist":["192.192.192.192","192.192.192.192"]},"mailerSettings":{"eu":True,"apiKey":"a string value","domain":"a string value","apiKeyPrivate":"a string value","header":{"key":"value"},"apiKeyPublic":"a string value","type":"a string value","url":"a string value"},"perIpThrottlingQuota":123,"elasticWritesConfigs":[{"clusterUri":"a string value","headers":{"key":"value"},"password":"a string value","index":"a string value","type":"a string value","user":"a string value"},{"clusterUri":"a string value","headers":{"key":"value"},"password":"a string value","index":"a string value","type":"a string value","user":"a string value"}],"lines":["a string value","a string value"],"useCircuitBreakers":True},"dateRaw":123,"admins":[{"createdAt":123,"password":"a string value","registration":{"key":"value"},"label":"a string value","username":"a string value"},{"createdAt":123,"password":"a string value","registration":{"key":"value"},"label":"a string value","username":"a string value"}]}
    headers = { 
        'Accept': 'application/json',
        'Content-Type': 'application/json',
        'Authorization': 'BasicZm9vOmJhcg==',
    }
    response = await client.request(
        method='POST',
        path='/api/import',
        headers=headers,
        json=body,
        )
    assert response.status == 200, 'Response body is : ' + (await response.read()).decode('utf-8')

