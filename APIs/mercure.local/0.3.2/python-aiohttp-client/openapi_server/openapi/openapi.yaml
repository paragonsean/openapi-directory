openapi: 3.0.2
info:
  contact:
    email: contact@mercure.rocks
    name: KÃ©vin Dunglas
    url: https://mercure.rocks
  description: "[Mercure](https://mercure.rocks) is a protocol allowing to push data\
    \ updates to web browsers and other HTTP clients in a convenient, fast, reliable\
    \ and battery-efficient way."
  license:
    name: GNU Affero General Public License v3.0 or later
    url: https://github.com/dunglas/mercure/blob/master/LICENSE
    x-spdx: AGPL-3.0-or-later
  title: The Mercure protocol
  version: 0.3.2
  x-apisguru-categories:
  - messaging
  x-logo:
    backgroundColor: '#FFFFFF'
    url: https://raw.githubusercontent.com/dunglas/mercure/master/public/mercure.svg?sanitize=true
  x-origin:
  - format: openapi
    url: https://raw.githubusercontent.com/dunglas/mercure/main/spec/openapi.yaml
    version: "3.0"
  x-providerName: mercure.local
externalDocs:
  description: The Mercure protocol specification
  url: https://mercure.rocks/spec
servers:
- url: http://mercure.local
security:
- Bearer: []
- Cookie: []
paths:
  /.well-known/mercure:
    get:
      externalDocs:
        description: Subscription specification
        url: https://mercure.rocks/spec#subscription
      operationId: well_known_mercure_get
      parameters:
      - description: "The topic to get updates from, can be a URI template (RFC6570)."
        explode: true
        in: query
        name: topic
        required: true
        schema:
          items:
            type: string
          type: array
        style: form
      - description: "The last received event id, to retrieve missed events."
        explode: true
        in: query
        name: Last-Event-ID
        required: false
        schema:
          type: string
        style: form
      - description: "The last received event id, to retrieve missed events, takes\
          \ precedence over the query parameter."
        explode: false
        in: header
        name: Last-Event-ID
        required: false
        schema:
          type: string
        style: simple
      responses:
        "200":
          content:
            text/event-stream: {}
          description: Event stream opened.
        "400":
          description: Missing topic parameter or invalid URI template.
        "401":
          description: Not authorized (missing or invalid JWT).
      summary: Subscribe to updates
      x-openapi-router-controller: openapi_server.controllers.default_controller
    post:
      externalDocs:
        description: Publishing specification
        url: https://mercure.rocks/spec#publication
      operationId: well_known_mercure_post
      requestBody:
        content:
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/__well_known_mercure_post_request'
        x-body-name: body
      responses:
        "200":
          content:
            text/plain: {}
          description: The id of this update
        "400":
          description: Invalid request
        "401":
          description: Not authorized (missing or invalid JWT).
      summary: Publish an update
      x-openapi-router-controller: openapi_server.controllers.default_controller
      x-codegen-request-body-name: body
  /.well-known/mercure/subscriptions:
    get:
      externalDocs:
        description: Subscription API
        url: https://mercure.rocks/spec#subscription-api
      operationId: well_known_mercure_subscriptions_get
      responses:
        "200":
          content:
            application/ld+json:
              schema:
                $ref: '#/components/schemas/Subscriptions'
          description: The list of active subscriptions
        "401":
          description: Not authorized (missing or invalid JWT).
      summary: Active subscriptions
      x-openapi-router-controller: openapi_server.controllers.default_controller
  /.well-known/mercure/subscriptions/{topic}:
    get:
      externalDocs:
        description: Subscription API
        url: https://mercure.rocks/spec#subscription-api
      operationId: well_known_mercure_subscriptions_topic_get
      parameters:
      - explode: false
        in: path
        name: topic
        required: true
        schema:
          type: string
        style: simple
      responses:
        "200":
          content:
            application/ld+json:
              schema:
                $ref: '#/components/schemas/Subscriptions'
          description: The list of active subscriptions
        "401":
          description: Not authorized (missing or invalid JWT).
      summary: Active subscriptions for the given topic
      x-openapi-router-controller: openapi_server.controllers.default_controller
  /.well-known/mercure/subscriptions/{topic}/{subscriber}:
    get:
      externalDocs:
        description: Subscription API
        url: https://mercure.rocks/spec#active-subscriptions
      operationId: well_known_mercure_subscriptions_topic_subscriber_get
      parameters:
      - explode: false
        in: path
        name: topic
        required: true
        schema:
          type: string
        style: simple
      - explode: false
        in: path
        name: subscriber
        required: true
        schema:
          type: string
        style: simple
      responses:
        "200":
          content:
            application/ld+json:
              schema:
                $ref: '#/components/schemas/Subscriptions'
          description: The list of active subscriptions
        "401":
          description: Not authorized (missing or invalid JWT).
      summary: Active subscription for the given topic and subscriber
      x-openapi-router-controller: openapi_server.controllers.default_controller
components:
  responses:
    "401":
      description: Not authorized (missing or invalid JWT).
  schemas:
    Subscription:
      properties:
        '@context':
          example: https://mercure.rocks/
          format: iri
          title: '@context'
          type: string
        active:
          title: active
          type: boolean
        id:
          example: /.well-known/mercure/subscriptions
          format: iri-reference
          title: id
          type: string
        lastEventID:
          example: urn:uuid:5e94c686-2c0b-4f9b-958c-92ccc3bbb4eb
          title: lastEventID
          type: string
        payload:
          title: payload
          type: object
        subscriber:
          example: urn:uuid:bb3de268-05b0-4c65-b44e-8f9acefc29d6
          title: subscriber
          type: string
        topic:
          example: "https://example.com/{selector}"
          title: topic
          type: string
        type:
          example: Subscription
          format: iri-reference
          title: type
          type: string
      required:
      - active
      - id
      - subscriber
      - topic
      - type
      title: Subscription
      type: object
    Subscriptions:
      properties:
        '@context':
          example: https://mercure.rocks/
          format: iri
          title: '@context'
          type: string
        id:
          example: /.well-known/mercure/subscriptions
          format: iri-reference
          title: id
          type: string
        lastEventID:
          example: urn:uuid:5e94c686-2c0b-4f9b-958c-92ccc3bbb4eb
          title: lastEventID
          type: string
        subscriptions:
          items:
            $ref: '#/components/schemas/Subscription'
          title: subscriptions
          type: array
        type:
          example: Subscriptions
          format: iri-reference
          title: type
          type: string
      required:
      - '@context'
      - id
      - lastEventID
      - subscriptions
      - type
      title: Subscriptions
      type: object
    __well_known_mercure_post_request:
      properties:
        data:
          description: The content of the new version of this topic.
          type: string
        id:
          description: "The topic's revision identifier: it will be used as the SSE's\
            \ `id` property."
          type: string
        private:
          description: "To mark an update as private. If not provided, this update\
            \ will be public."
          type: boolean
        retry:
          description: The SSE's `retry` property (the reconnection time).
          type: integer
        topic:
          description: "IRIs of the updated topic. If this key is present several\
            \ times, the first occurrence is considered to be the canonical URL of\
            \ the topic, and other ones are considered to be alternate URLs."
          items:
            type: string
          type: array
        type:
          description: The SSE's `event` property (a specific event type).
          type: string
      required:
      - data
      - topic
  securitySchemes:
    Bearer:
      bearerFormat: JWT
      description: Preferred for server to server
      scheme: bearer
      type: http
      x-bearerInfoFunc: openapi_server.controllers.security_controller.info_from_Bearer
    Cookie:
      description: Preferred for web browsers (the cookie name may change depending
        on the configuration)
      in: cookie
      name: mercureAuthorization
      type: apiKey
      x-apikeyInfoFunc: openapi_server.controllers.security_controller.info_from_Cookie
